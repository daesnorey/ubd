<div class="content">
  <input #search (keyup)=look_up(search.value) placeholder="Busqueda... " id="search">
  <button id="addButton" (click)="open_modal(content)"> + </button>
</div>
<div *ngIf="third_partys" class="content">
  <table class="table-custom">
    <thead>
      <tr>
        <th>ID</th>
        <th>TIPO DOCUMENTO</th>
        <th>NUMERO DOCUMENTO</th>
        <th>NOMBRES</th>
        <th>APELLIDOS</th>
        <th>FECHA NACIMIENTO</th>
        <th>ESTADO CIVIL</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let third of third_partys" (click)="open_modal(content,third)">
        <th>{{third.id}}</th>
        <td>
          <select [(ngModel)]="third.document_type" disabled="disabled">
            <option *ngFor="let item of document_type" [ngValue]="item.id">
              {{item.name}}
            </option>
          </select>
        </td>
        <td>{{third.document_number}}</td>
        <td>{{third.names}}</td>
        <td>{{third.surnames}}</td>
        <td>{{third.born_date | date:'yyyy-MM-dd'}}</td>
        <td>
          <select [(ngModel)]="third.marital_status" disabled="disabled">
            <option *ngFor="let item of marital_status" [ngValue]="item.id">
              {{item.name}}
            </option>
          </select>
        </td>
      </tr>
    </tbody>
  </table>
</div>
<ng-template #content let-c="close" let-d="dismiss">
  <div class="modal-header">
    <h4 class="modal-title">Detalles</h4>
    <button type="button" class="close" aria-label="Close" (click)="d()">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <mat-progress-bar mode="indeterminate" *ngIf="loading"></mat-progress-bar>
  <div class="modal-body">
    <mat-accordion>
      <mat-expansion-panel expanded hideToggle>
        <mat-expansion-panel-header>
          <mat-panel-title>
            Tercero
          </mat-panel-title>
          <mat-panel-description>
            Información del tercero
          </mat-panel-description>
        </mat-expansion-panel-header>

        <form #thirdForm="ngForm">
          <div class="col-md-12">
            <mat-form-field class="col-md-5">
              <mat-select placeholder="Tipo de documento" [(ngModel)]="third_party.document_type" name="document_type" [disabled]="!editThird" required>
                <mat-option *ngFor="let item of document_type" [value]="item.id">
                    {{item.name}}
                </mat-option>
              </mat-select>
            </mat-form-field>
            <mat-form-field class="col-md-5">
              <input matInput name="docnumber" [(ngModel)]="third_party.document_number" placeholder="Numero de documento" [disabled]="!editThird" #docnumber="ngModel" required minlength="6" maxlength="25">
              <mat-error *ngIf="docnumber.invalid && (docnumber.dirty || docnumber.touched) && docnumber.errors.minlength">Name must be at least 6 characters long</mat-error>
            </mat-form-field>
            <mat-form-field class="col-md-5">
              <input matInput name="names" [(ngModel)]="third_party.names" placeholder="Nombres" [disabled]="!editThird" #names="ngModel" required>
            </mat-form-field>
            <mat-form-field class="col-md-5" *ngIf="third_party.document_type!='N'">
              <input matInput name="surnames" [(ngModel)]="third_party.surnames" placeholder="Apellidos" [disabled]="!editThird" #surnames="ngModel" required>
            </mat-form-field>
            <mat-form-field class="col-md-5">
              <input matInput name="born_date" [matDatepicker]="matDate" [(ngModel)]="third_party.born_date" placeholder="Fecha de nacimiento" [disabled]="!editThird">
              <mat-datepicker-toggle matSuffix [for]="matDate"></mat-datepicker-toggle>
              <mat-datepicker #matDate></mat-datepicker>
            </mat-form-field>
            <mat-form-field class="col-md-5" *ngIf="third_party.document_type!='N'">
              <mat-select placeholder="Estado civil" [(ngModel)]="third_party.marital_status" name="marital_status" [disabled]="!editThird" required>
                <mat-option *ngFor="let item of marital_status" [value]="item.id">
                    {{item.name}}
                </mat-option>
              </mat-select>
            </mat-form-field>
          </div>
        </form>

        <mat-action-row *ngIf="editThird">
               <button mat-button color="primary" (click)="save_third()" [disabled]="loading || thirdForm.invalid">Guardar</button>
        </mat-action-row>
      </mat-expansion-panel>

      <mat-expansion-panel [disabled]="!third_party.id">
        <mat-expansion-panel-header>
          <mat-panel-title>
            Cliente
          </mat-panel-title>
          <mat-panel-description>
            Información del cliente
          </mat-panel-description>
        </mat-expansion-panel-header>

        <div class="col-md-12" *ngIf="createCli || client.id; else noClient">
          <mat-form-field class="col-md-2">
            <input matInput type="number" [(ngModel)]="client.factor" placeholder="Factor" [disabled]="!editClient">
          </mat-form-field>
          <mat-form-field class="col-md-4">
            <input matInput [(ngModel)]="client.phone" placeholder="Teléfono" [disabled]="!editClient">
          </mat-form-field>
          <mat-form-field class="col-md-5">
            <input matInput [(ngModel)]="client.address" placeholder="Direccion" [disabled]="!editClient">
          </mat-form-field>
        </div>
        <ng-template #noClient> No existe cliente </ng-template>
        <mat-action-row *ngIf="!client || !client.id">
          <button mat-button color="primary" *ngIf="!createCli" (click)="createCli=true; editClient=true">Crear</button>
          <button mat-button color="primary" *ngIf="createCli" (click)="save_client()" [disabled]="!editClient">Guardar</button>
        </mat-action-row>
      </mat-expansion-panel>
      <mat-expansion-panel [disabled]="!third_party.id">
        <mat-expansion-panel-header>
          <mat-panel-title>
            Empleado
          </mat-panel-title>
          <mat-panel-description>
            Información del empleado
          </mat-panel-description>
        </mat-expansion-panel-header>

        <div class="col-md-12" *ngIf="createEmp || employee.id; else noEmployee">
          <mat-form-field class="col-md-5">
            <input matInput type="number" [(ngModel)]="employee.factor" placeholder="Factor" [disabled]="!editEmployee">
          </mat-form-field>
          <mat-form-field class="col-md-5">
            <input matInput type="tel" [(ngModel)]="employee.phone" placeholder="Teléfono" [disabled]="!editEmployee">
          </mat-form-field>
          <mat-form-field class="col-md-5">
            <input matInput [matDatepicker]="initDate" [(ngModel)]="employee.start_date" placeholder="Fecha de ingreso" [disabled]="!editEmployee">
            <mat-datepicker-toggle matSuffix [for]="initDate"></mat-datepicker-toggle>
            <mat-datepicker #initDate></mat-datepicker>
          </mat-form-field>
          <mat-form-field class="col-md-5">
            <input matInput [matDatepicker]="endDate" [(ngModel)]="employee.end_date" placeholder="Fecha de retiro" [disabled]="!editEmployee">
            <mat-datepicker-toggle matSuffix [for]="endDate"></mat-datepicker-toggle>
            <mat-datepicker #endDate></mat-datepicker>
          </mat-form-field>
        </div>
        <ng-template #noEmployee> No existe empleado </ng-template>
        <mat-action-row *ngIf="!employee || !employee.id">
          <button mat-button color="primary" *ngIf="!createEmp" (click)="createEmp=true; editEmployee=true">Crear</button>
          <button mat-button color="primary" *ngIf="createEmp" (click)="save_employee()" [disabled]="!editEmployee">Guardar</button>
        </mat-action-row>
      </mat-expansion-panel>
    </mat-accordion>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-outline-dark" (click)="c()">Cerrar</button>
  </div>
</ng-template>
